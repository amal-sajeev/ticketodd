{% extends "base.html" %}
{% block title %}Register ‚Äî PR&DW Portal{% endblock %}
{% block content %}
<div class="auth-container">
  <div class="auth-card glass-strong" style="max-width:480px;">
    <h1>üèõÔ∏è Create Account</h1>
    <p class="auth-subtitle">Register as a citizen to file and track grievances</p>
    <form id="regForm" onsubmit="return handleRegister(event)">
      <div class="form-group"><label>Full Name</label><input type="text" class="form-control" id="fullName" required></div>
      <div class="form-row">
        <div class="form-group"><label>Email</label><input type="email" class="form-control" id="email" required></div>
        <div class="form-group"><label>Phone</label><input type="text" class="form-control" id="phone" placeholder="Optional"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Username</label><input type="text" class="form-control" id="username" required minlength="3"></div>
        <div class="form-group"><label>Password</label><input type="password" class="form-control" id="password" required minlength="6"></div>
      </div>
      <div id="regError" class="text-sm" style="color:#C62828;margin-bottom:1rem;display:none;"></div>
      <button type="submit" class="btn btn-primary btn-block" id="regBtn">Create Account</button>
    </form>
    <p class="mt-2 text-sm">Already have an account? <a href="/login" class="auth-link">Sign in</a></p>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
async function handleRegister(e) {
  e.preventDefault();
  const btn = document.getElementById('regBtn');
  const errEl = document.getElementById('regError');
  errEl.style.display = 'none';
  btn.textContent = 'Creating...'; btn.disabled = true;
  const body = {
    full_name: document.getElementById('fullName').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value || null,
    username: document.getElementById('username').value,
    password: document.getElementById('password').value,
    role: 'citizen',
  };
  try {
    const data = await api('POST', '/auth/register', body);
    setAuth(data.access_token, data.user);
    window.location.href = '/dashboard';
  } catch (err) {
    errEl.textContent = err.message || 'Registration failed';
    errEl.style.display = 'block';
    btn.textContent = 'Create Account'; btn.disabled = false;
  }
}
</script>
{% endblock %}
